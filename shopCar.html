<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>商品分类</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/center.css">
</head>
<body style="overflow:scroll;overflow-y:hidden">
<div id="shopCarOut">
    <!--头部-->
    <div id="shopCarHeard">
        <a href="javascript:;">
            <img src="./img/home.png">
        </a>
        <a href="javascript:;">
            <img src="./img/search.png">
        </a>
        <input type="text" placeholder="请输入关键字" class="shopMo" id="shopMo1">

        <table>
            <tbody>
            <tr>
                <td>1血腥玛丽(Bloody Mary)</td>
            </tr>
            </tbody>
        </table>

    </div>
    <!--两个列表-->
    <div id="shopCarList">
        <!--品类列表-->
        <ul id="goodList">
            <li class="goodsA11">
                <span>全部</span>
                <span class="goodFan"></span>
            </li>
            <li class="goods1">
                <span>鸡尾酒</span>
                <span class="goodFan"></span>
            </li>
            <li class="goods2">
                <span>优惠套餐</span>
                <span class="goodFan"></span>
            </li>
            <li class="goods3">
                <span>威士忌单杯</span>
                <span class="goodFan"></span>
            </li>
            <li class="goods4">
                <span>威士忌</span>
                <span class="goodFan"></span>
            </li>
            <li class="goods5">
                <span>生啤</span>
                <span class="goodFan"></span>
            </li>
            <li class="goods6">
                <span>零食</span>
                <span class="goodFan"></span>
            </li>
        </ul>
        <div class="foodListOut">
            <ul id="foodList">
                <li class="goods11 goods1all a1" data-id="1">
                    <a href="javascript:;" class="touched">
                        <img src="./img/product04.png">
                        <span class="foodName">1血腥玛丽(Bloody Mary)</span>
                        <div class="foodPrice">
                            <span>￥</span>
                            <span class="foodPrice1">65.00</span>
                        </div>
                        <span class="sellerNum">已售228</span>
                    </a>
                    <span class="foodListBigJia"></span>
                    <span class="foodListJian"></span>
                    <span class="foodListNum">2</span>
                    <span class="foodListJia"></span>
                </li>
                <li class="goods22 goods1all a2" data-id="2">
                    <a href="javascript:;" class="touched">
                        <img src="./img/product04.png">
                        <span class="foodName">2忧郁美人(Blue Lady)</span>
                        <div class="foodPrice">
                            <span>￥</span>
                            <span class="foodPrice1">65.00</span>
                        </div>
                        <span class="sellerNum">已售228</span>
                    </a>
                    <span class="foodListBigJia"></span>
                    <span class="foodListJian"></span>
                    <span class="foodListNum">12</span>
                    <span class="foodListJia"></span>
                </li>
                <li class="goods33 goods1all a3" data-id="3">
                    <a href="javascript:;" class="touched">
                        <img src="./img/product04.png">
                        <span class="foodName">3忧郁美人(Blue Lady)</span>
                        <div class="foodPrice">
                            <span>￥</span>
                            <span class="foodPrice1">65.00</span>
                        </div>
                        <span class="sellerNum">已售228</span>
                    </a>
                    <span class="foodListBigJia"></span>
                    <span class="foodListJian"></span>
                    <span class="foodListNum">12</span>
                    <span class="foodListJia"></span>
                </li>
                <li class="goods44 goods1all a4" data-id="4">
                    <a href="javascript:;" class="touched">
                        <img src="./img/product04.png">
                        <span class="foodName">4忧郁美人(Blue Lady)</span>
                        <div class="foodPrice">
                            <span>￥</span>
                            <span class="foodPrice1">65.00</span>
                        </div>
                        <span class="sellerNum">已售228</span>
                    </a>
                    <span class="foodListBigJia"></span>
                    <span class="foodListJian"></span>
                    <span class="foodListNum">12</span>
                    <span class="foodListJia"></span>
                </li>
                <li class="goods55 goods1all a5" data-id="5">
                    <a href="javascript:;" class="touched">
                        <img src="./img/product04.png">
                        <span class="foodName">5忧郁美人(Blue Lady)</span>
                        <div class="foodPrice">
                            <span>￥</span>
                            <span class="foodPrice1">65.00</span>
                        </div>
                        <span class="sellerNum">已售228</span>
                    </a>
                    <span class="foodListBigJia"></span>
                    <span class="foodListJian"></span>
                    <span class="foodListNum">12</span>
                    <span class="foodListJia"></span>
                </li>
                <li class="goods66 goods1all a6" data-id="6">
                    <a href="javascript:;" class="touched">
                        <img src="./img/product04.png">
                        <span class="foodName">6忧郁美人(Blue Lady)</span>
                        <div class="foodPrice">
                            <span>￥</span>
                            <span class="foodPrice1">65.00</span>
                        </div>
                        <span class="sellerNum">已售228</span>
                    </a>
                    <span class="foodListBigJia"></span>
                    <span class="foodListJian"></span>
                    <span class="foodListNum">12</span>
                    <span class="foodListJia"></span>
                </li>
            </ul>
        </div>

    </div>
    <!--购物车-->
    <div id="shopCarB">
        <img src="./img/gouwuche.png">
        <span class="allNumber">0</span>
        <span class="dollarFu">￥</span>
        <span class="allPrice">0.00</span>
        <button id="payShopCar">结算</button>
    </div>
    <!--小列表-->
    <div id="smallListOut">
        <div id="smallList">
            <div class="smallListDiv">
                <span class="smallTextShop">购物车</span>
                <a href="javascript:;" class="closedSmallList">
                    <img src="./img/shanchu.png">
                    <span> 清空</span>
                </a>
            </div>
            <ul class="smallListQin" id="smallListQin1">

            </ul>
        </div>
    </div>


</div>


</body>
<script src="./js/zepto.js"></script>
<script src="./js/touch.js"></script>

<script>
    document.addEventListener("tap",function (ev) {
        ev=ev||event;
        ev.preventDefault();
    });
    //适配
    (function () {
        var styleNode=document.createElement("style");
        var width=document.documentElement.clientWidth/16;
        styleNode.innerHTML="html{font-size:"+width+"px!important}";
        document.head.appendChild(styleNode)
    })();
    (function () {
        var styleNode=document.createElement("style");
        styleNode.innerHTML="html,bory{height:100%;}";
        document.head.appendChild(styleNode)
    })();
    $(function () {

//      全局变量---------------------------------------------------------------------------
//      单个商品数量
        let arr1={}
//      商品id
        let arrName={};
        //商品总数量
        let allNumber=0;
//        商品总价
        let arrPrice=0;
//        商品单价
        let price1={};
//       ajax数据
        var data={state: true,
            msg: "OK",
            code: 200,
            data: {
                benefit: {
                    total: 0
                },
                products: {
                    1: {
                        num: 0,
                        name: "香槟",
                        subtotal: 0
                    },
                    2:{
                        num: 0,
                        name: "香1槟",
                        subtotal: 0
                    },
                    3:{
                        num: 0,
                        name: "香2槟",
                        subtotal: 0
                    },
                    4:{
                        num: 0,
                        name: "香3槟",
                        subtotal: 0
                    },
                    5:{
                        num: 0,
                        name: "香4槟",
                        subtotal: 0
                    },
                    6:{
                        num: 0,
                        name: "香5槟",
                        subtotal: 0
                    }
                },
                total: 0,
                num: 0
            }
        }
//      业务逻辑---------------------------------------------------------------------------
        //左侧分类栏的点击逻辑
        $("#goodList li").on("tap",function () {

            $("#goodList li").css("color","#999")
            $(".goodFan").css("display","none")
            $(this).css("color","deeppink")
            $(this).children(".goodFan").css("display","block")
            switch ($(this)[0].className){
                case "goodsA11":
                    $(".goods1all").show()
                    break;
                case "goods1":
                    $(".goods1all").hide()
                    $(".goods11").show()
                    break;
                case "goods2":
                    $(".goods1all").hide()
                    $(".goods22").show()
                    break;
                case "goods3":
                    $(".goods1all").hide()
                    $(".goods33").show()
                    break;
                case "goods4":
                    $(".goods1all").hide()
                    $(".goods44").show()
                    break;
                case "goods5":
                    $(".goods1all").hide()
                    $(".goods55").show()
                    break;
                case "goods6":
                    $(".goods1all").hide()
                    $(".goods66").show()
                    break;

            }


        });
//GOODlist 逻辑----------------------------------------------------------------------------
        //goods 大加号逻辑
        $(".foodListBigJia").on("click",function () {
            data.data.num +=1
            var index1=parseInt($(this).parent().attr("data-id"))
            data.data.products[index1].num =1
            data.data.products[index1].subtotal=-(0-$(this).parent().children("a").children(".foodPrice").children(".foodPrice1").text())
            data.data.total += data.data.products[index1].subtotal
            var price111=$(this).parent().children("a").children(".foodPrice").children(".foodPrice1").text()
            createLi(data.data.products[index1].name,data.data.products[index1].num,price111,index1)
            $(".allNumber").text(data.data.num)
            $(".allPrice").text(data.data.total)
            $(this).parent().children(".foodListJian").show()
            $(this).parent().children(".foodListJia").show()
            $(this).parent().children(".foodListNum").show()
            $(this).parent().children(".foodListNum").text(1)
            $(this).hide()
        });
        //goods 小加号逻辑
        $(".foodListJia").on("tap",function () {
            data.data.num +=1;
            var index1=parseInt($(this).parent().attr("data-id"))
            data.data.products[index1].num +=1
            data.data.products[index1].subtotal +=-(0-$(this).parent().children("a").children(".foodPrice").children(".foodPrice1").text())
            data.data.total +=-(0-$(this).parent().children("a").children(".foodPrice").children(".foodPrice1").text())
            $(this).parent().children(".foodListNum").text(data.data.products[index1].num)
            $(".allNumber").text(data.data.num)
            $(".allPrice").text(data.data.total)
            console.log(data.data.products[index1].subtotal,data.data.products[index1].num)
            $("#smallListQin1").children(`.a${index1}`).children(".smallFoodPrice").text(data.data.products[index1].subtotal)
            $("#smallListQin1").children(`.a${index1}`).children(".smallNum").text(data.data.products[index1].num)
        });
        //goods 减号逻辑
        $(".foodListJian").on("tap",function () {
            data.data.num -=1
            var index1=parseInt($(this).parent().attr("data-id"))
            data.data.products[index1].num -=1
            console.log( data.data.products[index1].num)
            $(this).parent().children(".foodListNum").text(data.data.products[index1].num)
            data.data.products[index1].subtotal -=-(0-$(this).parent().children("a").children(".foodPrice").children(".foodPrice1").text())
            data.data.total -=-(0-$(this).parent().children("a").children(".foodPrice").children(".foodPrice1").text())
            $("#smallListQin1").children(`.a${index1}`).children(".smallFoodPrice").text(data.data.products[index1].subtotal)
            $("#smallListQin1").children(`.a${index1}`).children(".smallNum").text(data.data.products[index1].num)
           if(data.data.products[index1].num<=0){
                $(this).parent().children(".foodListJian").hide()
                $(this).parent().children(".foodListJia").hide()
                $(this).parent().children(".foodListNum").hide()
                $(this).parent().children(".foodListBigJia").show()
               $("#smallListQin1").children(`.a${index1}`).remove()
            }
            if(data.dat)
            if(data.data.num<=0){
                data.data.num=0
                data.data.products[index1].num=0
                data.data.products[index1].subtotal=0
            }
            if(arrPrice<=0){
                arrPrice=0
            }

            $(".allPrice").text(data.data.total)
            $(".allNumber").text(data.data.num)
        });
        //smallList加号逻辑
        $(document).on("tap",".smallJia",function (ev) {
           var  ev=ev||event;
            ev.preventDefault();
            ev.stopPropagation();
            data.data.num +=1
            var index1=parseInt($(this).parent().attr("data-id"))
            data.data.products[index1].num +=1
            data.data.products[index1].subtotal +=-(0-$("#foodList").children(`.a${index1}`).children("a").children(".foodPrice").children(".foodPrice1").text())
            data.data.total +=-(0-$("#foodList").children(`.a${index1}`).children("a").children(".foodPrice").children(".foodPrice1").text())
            $(this).parent().children(".smallNum").text(data.data.products[index1].num)
            $(this).parent().children(".smallFoodPrice").text(data.data.products[index1].subtotal)
            $("#foodList").children(`.a${index1}`).children(".foodListNum").text(data.data.products[index1].num)
            $(".allNumber").text(data.data.num)
            $(".allPrice").text(data.data.total)
        });
        //smallList减号
        $(document).on("tap",".smallJian",function (ev) {

            var ev=ev||event;
            ev.preventDefault();
            ev.stopPropagation()
            console.log(ev)
            data.data.num-=1
            var index1=parseInt($(this).parent().attr("data-id"))
            data.data.products[index1].num -=1
            if(data.data.products[index1].num<=0){
                data.data.products[index1].num=0
                $("#foodList").children(`.a${index1}`).children(".foodListNum").hide()
                $("#foodList").children(`.a${index1}`).children(".foodListJian").hide()
                $("#foodList").children(`.a${index1}`).children(".foodListJia").hide()
                $("#foodList").children(`.a${index1}`).children(".foodListBigJia").show()
                data.data.total -=-(0-$("#foodList").children(`.a${index1}`).children("a").children(".foodPrice").children(".foodPrice1").text())
                $(this).parent().remove()
            }else{
                data.data.products[index1].subtotal -=-(0-$("#foodList").children(`.a${index1}`).children("a").children(".foodPrice").children(".foodPrice1").text())
                data.data.total -=-(0-$("#foodList").children(`.a${index1}`).children("a").children(".foodPrice").children(".foodPrice1").text())
                console.log(-(0-$("#foodList").children(`.a${index1}`).children("a").children(".foodPrice").children(".foodPrice1").text()))
                $(this).parent().children(".smallNum").text(data.data.products[index1].num)
                $(this).parent().children(".smallFoodPrice").text(data.data.products[index1].subtotal)
                $("#foodList").children(`.a${index1}`).children(".foodListNum").text(data.data.products[index1].num)
            }

            $(".allNumber").text(data.data.num)
            $(".allPrice").text(data.data.total)

            if(data.data.num<=0){
                data.data.num=0
                $("#smallListOut").hide()
                $("#foodList").children(`li`).children(".foodListNum").hide()
                $("#foodList").children(`li`).children(".foodListJian").hide()
                $("#foodList").children(`li`).children(".foodListJia").hide()
                $("#foodList").children(`li`).children(".foodListBigJia").show()
            }
            if(data.data.total<=0){
                data.data.total=0
            }

            $(".allPrice").text(data.data.total)
            $(".allNumber").text(data.data.num)

        });
        //创建购物车列表
        function createLi(name,num,price,id) {
            console.log(name,num,price,id)
            var li=document.createElement("li")
            li.setAttribute("data-id",id)
            li.className=`a${id}`
            var smallFoodName=document.createElement("span")
            smallFoodName.className="smallFoodName"
            smallFoodName.innerHTML=name
           li.appendChild(smallFoodName)
            var smallFoodDollar=document.createElement("span")
            smallFoodDollar.className="smallFoodDollar"
            smallFoodDollar.innerHTML="￥"
            li.appendChild(smallFoodDollar)
            var smallFoodPrice=document.createElement("span")
            smallFoodPrice.className="smallFoodPrice"
            li.appendChild(smallFoodPrice)
            smallFoodPrice.innerHTML=price
            var smallJian=document.createElement("span")
            smallJian.className="smallJian"
            li.appendChild(smallJian)
            var smallNum=document.createElement("span")
            smallNum.className="smallNum"
            smallNum.innerHTML=num
            li.appendChild(smallNum)
            var smallJia=document.createElement("span")
            smallJia.className="smallJia"
            li.appendChild(smallJia)
            $(".smallListQin")[0].appendChild(li)
        }
        //弹出购物车
        $("#shopCarB").on("tap",function () {
            if(data.data.num==0){
                return
            }
            $("#smallListOut").show()
        });


        $("#payShopCar").on("tap",function () {
            alert(1)
        });

        $(".smallListDiv").on("tap",function (ev) {
            var ev=ev||window.event
            ev.stopPropagation()
            $("#smallListOut").hide()
        });
        //清空
        $(".closedSmallList").on("tap",function () {
            //清空所有数据
            data={state: true,
                msg: "OK",
                code: 200,
                data: {
                    benefit: {
                        total: 0
                    },
                    products: {

                    },
                    total: 0,
                    num: 0
                }
            }

            $(".foodListJian").hide();
            $(".foodListNum").hide();
            $(".foodListJia").hide();
            $(".foodListBigJia").show();
            $(".allNumber").text(data.data.num);
            $(".allPrice").text(data.data.total);
           document.getElementById("smallListQin1").innerHTML=""
        });



    })
</script>
</html>